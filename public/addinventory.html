<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Warehouse Management</title>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <link rel="stylesheet" href="css/styles.css" />
    <script src="https://use.fontawesome.com/0c7a3095b5.js"></script>
  </head>
  <body>
    <nav class="col-md-3 col-lg-2 d-md-block bg-dark sidebar">
      <div class="sidebar-sticky">
        <h3 class="dashboard-logo text-center text-primary my-4">IMSYS</h3>
        <div class="text-center mb-4">
          <img
            src="image/profile.png"
            class="rounded-circle border border-primary"
            alt="profile image"
            id="dashboard_user_img"
            width="60"
            height="60"
          />
          <span class="d-block text-white mt-2" id="username"></span>
        </div>
        <ul class="nav flex-column">
          <li class="nav-item">
            <a class="nav-link" href="#" id="dashboardLink">
              <i class="fa fa-dashboard"></i> <span>Dashboard</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="addinventory.html">
              <i class="fa fa-dashboard"></i> <span>Add Inventory</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="editinventory.html">
              <i class="fa fa-edit"></i> <span>Edit Inventory</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="admin-logs.html">
                <i class="fa fa-history"></i> <span>Admin Logs</span>
            </a>
        </li>
          <li class="nav-item mt-auto">
            <a class="nav-link text-danger" href="#" id="logoutBtn">
              <i class="fa fa-power-off"></i> <span>Logout</span>
            </a>
          </li>
        </ul>
      </div>
    </nav>

    <div class="container-fluid main-container">
      <div id="filter-section" class="card mb-4">
        <div class="card-header">Filter Products</div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-3">
                <input type="text" id="search-bar" class="form-control mb-2" placeholder="Search by product name...">
            </div>
            <div class="col-md-3">
                <select id="category-filter" class="form-control mb-2">
                    <option value="">All Categories</option>
                </select>
            </div>
            <div class="col-md-3">
                <button id="toggle-advanced-filters" class="btn btn-secondary mb-2">Advanced Filters</button>
            </div>
        </div>
        <div id="advanced-filters" class="hidden">
            <div class="row">
                <div class="col-md-3">
                    <input type="number" id="min-price" class="form-control mb-2" placeholder="Min Price">
                </div>
                <div class="col-md-3">
                    <input type="number" id="max-price" class="form-control mb-2" placeholder="Max Price">
                </div>
                <div class="col-md-3">
                    <input type="number" id="min-quantity" class="form-control mb-2" placeholder="Min Quantity">
                </div>
                <div class="col-md-3">
                    <input type="number" id="max-quantity" class="form-control mb-2" placeholder="Max Quantity">
                </div>
                <div class="col-md-3">
                    <input type="number" id="min-reorder-level" class="form-control mb-2" placeholder="Min Reorder Level">
                </div>
                <div class="col-md-3">
                    <input type="number" id="max-reorder-level" class="form-control mb-2" placeholder="Max Reorder Level">
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-3">
                <button id="filter-button" class="btn btn-primary mb-2">Filter</button>
            </div>
            <div class="col-md-3">
                <button id="reset-button" class="btn btn-warning mb-2">Reset Filters</button>
            </div>
        </div>
    </div>
</div>

      <div class="defaultclass">
        <div class="card">
          <div class="card-header">Product List</div>
          <div class="card-body">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th class="sortable" data-sort="productID">ID</th>
                  <th class="sortable" data-sort="productName">Name</th>
                  <th class="sortable" data-sort="description">Description</th>
                  <th class="sortable" data-sort="price">Price</th>
                  <th class="sortable" data-sort="category">Category</th>
                  <th class="sortable" data-sort="quantity">Quantity</th>
                  <th class="sortable" data-sort="reorderLevel">
                    Reorder Level
                  </th>
                </tr>
              </thead>
              <tbody id="productList"></tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="container mt-5">
        <h1 class="mb-4">Warehouse Management System</h1>
        <div class="card mb-4">
          <div class="card-header">Add New Product</div>
          <div class="card-body">
            <form id="productForm">
              <div class="form-group">
                <label for="productName">Product Name</label>
                <input
                  type="text"
                  class="form-control"
                  id="productName"
                  required
                />
              </div>
              <div class="form-group">
                <label for="description">Description</label>
                <input
                  type="text"
                  class="form-control"
                  id="description"
                  required
                />
              </div>
              <div class="form-group">
                <label for="price">Price</label>
                <input type="number" class="form-control" id="price" required />
              </div>
              <div class="form-group">
                <label for="category">Category</label>
                <input
                  type="text"
                  class="form-control"
                  id="category"
                  required
                />
              </div>
              <div class="form-group">
                <label for="quantity">Quantity</label>
                <input
                  type="number"
                  class="form-control"
                  id="quantity"
                  required
                />
              </div>
              <div class="form-group">
                <label for="reorderLevel">Reorder Level</label>
                <input
                  type="number"
                  class="form-control"
                  id="reorderLevel"
                  required
                />
              </div>
              <button type="submit" class="btn btn-primary">Add Product</button>
              <a class="btn btn-primary" id="backToDashboard">Back</a>
            </form>
          </div>
        </div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="js/scripts.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // Fetch the username from the server and update the username span
        fetch("/api/getUsername")
          .then((response) => {
            if (!response.ok) {
              throw new Error("Network response was not ok");
            }
            return response.json();
          })
          .then((data) => {
            document.getElementById("username").textContent = data.username;
          })
          .catch((error) => {
            console.error(
              "There was a problem with the fetch operation:",
              error
            );
            document.getElementById("username").textContent = "Guest"; // Fallback text
          });

        // Logout button functionality
        document
          .getElementById("logoutBtn")
          .addEventListener("click", (event) => {
            event.preventDefault(); // Prevent default action

            fetch("/logout", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
            }).then((response) => {
              if (response.ok) {
                window.location.href = "index.html"; // Redirect to index page after logout
              } else {
                // Handle logout failure
                alert("Logout failed");
              }
            });
          });

        // Update the Dashboard link based on URL parameter
        const urlParams = new URLSearchParams(window.location.search);
        const from = urlParams.get("from") || "dashboard"; // Default to 'dashboard' if 'from' is not present
        const dashboardLink =
          from === "admindashboard" ? "admindashboard.html" : "dashboard.html";
        document.getElementById("dashboardLink").href = dashboardLink;

        // Update the Back button in the form
        document.getElementById("backToDashboard").href = dashboardLink;
      });
    </script>
  </body>
</html>
